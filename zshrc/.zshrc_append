#!/bin/zsh

#===============================================================================
# plugin manager section
#===============================================================================
source "$HOME/.local/share/antigen/antigen.zsh"
antigen bundle zsh-users/zsh-autosuggestions
antigen bundle zsh-users/zsh-syntax-highlighting

# # Too slow to load
# antigen bundle marlonrichert/zsh-autocomplete
# antigen bundle zsh-users/zsh-completions
# antigen bundle agkozak/zsh-z

# # Even slower to load
# antigen use oh-my-zsh
# antigen theme robbyrussell
# antigen bundle git
# antigen bundle colored-man-pages

antigen apply

#===============================================================================
# User configuration
#===============================================================================
# custom setup
. "$HOME/.shellfunc"
if [[ -d "$HOME/.vim/plugged/fzf" ]]; then
    addThisPath "$HOME/.vim/plugged/fzf/bin"
    . "$HOME/.vim/plugged/fzf/shell/completion.zsh"
    . "$HOME/.vim/plugged/fzf/shell/key-bindings.zsh"
fi
bindkey -v
if [[ -x "$HOME/.vim/plugged/fzf/bin/fzf" ]]; then
    addThisPath "$HOME/.vim/plugged/fzf/bin"
    if [[ -d "$HOME/.vim/plugged/fzf/shell" ]]; then
        for f in $(ls  "$HOME/.vim/plugged/fzf/shell/"*.zsh); do
            . "$f"
        done
    fi
    alias his='eval "$(history | tac | sed -n "s/[ 0-9]\+\(.*\)/\1/p" | fzf)"'
fi

eval "$(starship init zsh)"

# source asdf
. "$ASDF_DIR/asdf.sh"
. "$ASDF_DIR/completions/asdf.bash"

# refresh the ssh tty
# https://babushk.in/posts/renew-environment-tmux.html
if [ -n "$TMUX" ]; then
    function refresh {
        tmux_env="$(tmux show-environment)"
        new_ssh_tty="$(echo -n "$tmux_env" | grep '^SSH_TTY')"
        if [[ -n $new_ssh_tty ]]; then
            export "$new_ssh_tty"
        fi
    }
else
    function refresh { }
fi

function preexec {
    refresh
}

